Q10. Write a PL/SQL block for a Library Management System using the following tables:
Borrower(Roll_no, Name, DateOfIssue, NameOfBook, Status)
Fine(Roll_no, Date, Amt)
Requirements:
1.	Accept Roll_no and NameOfBook from the user.
2.	Check the number of days elapsed from the DateOfIssue till today.
3.	Apply fine rules:
o	If days ≤ 15 → No fine.
o	If days between 16 and 30 → Fine = Rs. 5 per day.
o	If days > 30 → Fine = Rs. 50 per day.
4.	After the book is returned:
o	Update the Status from 'I' (Issued) to 'R' (Returned).
o	Insert fine details (if any) into the Fine table.
5.	Handle exceptions such as:
o	Book not issued to the given roll number (NO_DATA_FOUND)
o	Invalid Roll Number (user-defined exception)

CODE=-
CREATE DATABASE LibraryDB1;
USE LibraryDB1;

-- Create tables
CREATE TABLE Borrower (
  Roll_no INT PRIMARY KEY,
  Name VARCHAR(50),
  DateOfIssue DATE,
  NameOfBook VARCHAR(50),
  Status CHAR(1)  -- 'I' = Issued, 'R' = Returned
);

CREATE TABLE Fine (
  Roll_no INT,
  Date_ DATE,
  Amt DECIMAL(10,2)
);

-- Sample data
INSERT INTO Borrower VALUES
(1, 'Amit', '2025-10-10', 'DBMS', 'I'),
(2, 'Sneha', '2025-10-20', 'OS', 'I');
COMMIT;

-- ✅ Stored Procedure to check fine and return book
DELIMITER $$

CREATE PROCEDURE ReturnBook(IN p_roll INT, IN p_book VARCHAR(50))
BEGIN
  DECLARE v_date DATE;
  DECLARE v_days INT;
  DECLARE v_fine DECIMAL(10,2) DEFAULT 0;
  DECLARE v_status CHAR(1);
  DECLARE not_found BOOL DEFAULT FALSE;

  -- Try to get borrower details
  SELECT DateOfIssue, Status INTO v_date, v_status
  FROM Borrower
  WHERE Roll_no = p_roll AND NameOfBook = p_book
  LIMIT 1;

  -- SET SQL_SAFE_UPDATES = 0;
  -- Calculate days since issued
  SET v_days = DATEDIFF(CURDATE(), v_date);

  -- Fine rules
  IF v_days <= 15 THEN
    SET v_fine = 0;
  ELSEIF v_days BETWEEN 16 AND 30 THEN
    SET v_fine = (v_days - 15) * 5;
  ELSE
    SET v_fine = (v_days - 30) * 50;
  END IF;

  -- Update status to Returned
  UPDATE Borrower
  SET Status = 'R'
  WHERE Roll_no = p_roll AND NameOfBook = p_book;

  -- Insert fine if any
  IF v_fine > 0 THEN
    INSERT INTO Fine VALUES (p_roll, CURDATE(), v_fine);
  END IF;

  -- Display results
  SELECT CONCAT('Book Returned Successfully! Days: ', v_days, ', Fine: Rs.', v_fine) AS Message;
  
END $$

DELIMITER ;

-- ✅ To run procedure:
CALL ReturnBook(1, 'DBMS');

